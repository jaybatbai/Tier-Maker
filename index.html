<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#09090b">
    <title>Tier List Pro - Master Edition</title>
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
        :root {
            --bg-base: #09090b; --bg-surface: #18181b; --bg-elevated: #27272a;
            --border-color: #27272a; --border-hover: #3f3f46;
            --primary: #10b981; --primary-hover: #059669;
            --accent: #3b82f6; --danger: #ef4444; --danger-bg: rgba(239, 68, 68, 0.1);
            --text-main: #f4f4f5; --text-muted: #a1a1aa;
            --radius-lg: 16px; --radius-md: 12px; --radius-sm: 8px; --radius-pill: 9999px;
            --shadow-float: 0 20px 40px -10px rgba(0,0,0,0.7);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--bg-elevated); border-radius: 10px; }
        body { background: var(--bg-base); color: var(--text-main); margin: 0; padding: 0; padding-bottom: 100px; overscroll-behavior: none; -webkit-font-smoothing: antialiased; }
        .hidden { display: none !important; }
        #app-container { width: 100%; max-width: 960px; margin: 0 auto; background: var(--bg-base); min-height: 100vh; border-left: 1px solid var(--border-color); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; position: relative; transition: all 0.3s; }
        
        /* Ch·ªânh s·ª≠a Drag Overlay ƒë·ªÉ ho·∫°t ƒë·ªông m∆∞·ª£t h∆°n */
        #drop-overlay { position: fixed; inset: 0; background: rgba(16, 185, 129, 0.9); z-index: 10000; display: none; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 700; backdrop-filter: blur(8px); border: 8px dashed rgba(255,255,255,0.5); pointer-events: none; }
        #loading-overlay { z-index: 10002; flex-direction: column; color: white; font-weight: 600; font-size: 1.2rem; display: none; align-items: center; justify-content: center; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Toast Notification */
        #toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(50px); background: var(--primary); color: white; padding: 10px 24px; border-radius: 30px; font-weight: 600; opacity: 0; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55); z-index: 10000; pointer-events: none; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        #trash-zone { position: fixed; bottom: 100px; right: 30px; width: 70px; height: 70px; background: var(--danger); color: white; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 1.8rem; z-index: 9999; box-shadow: 0 10px 25px rgba(239,68,68,0.5); border: 3px solid #fff; transition: transform 0.2s; }
        #trash-zone.hover { transform: scale(1.2); background: #dc2626; }

        #menu-screen { padding: 60px 30px; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .app-title { color: var(--text-main); font-size: 2.5rem; margin: 0 0 40px 0; font-weight: 800; letter-spacing: -1px; text-transform: uppercase; }
        .app-title span { color: var(--primary); }
        .menu-actions { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 380px; margin-bottom: 50px; }
        .btn-create { width: 100%; padding: 16px; background: var(--primary); color: #fff; font-weight: 600; border: none; border-radius: var(--radius-md); font-size: 1.05rem; cursor: pointer; transition: all 0.2s; }
        .btn-data { width: 100%; padding: 14px; background: var(--bg-surface); color: var(--text-main); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-weight: 500; cursor: pointer; transition: 0.2s; font-size: 0.95rem; }
        #list-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; width: 100%; }
        
        .list-item { background: var(--bg-surface); border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--border-color); cursor: pointer; transition: transform 0.1s ease, background 0.2s; display: flex; flex-direction: column; position: relative; }
        .list-item:active { transform: scale(0.97); }
        .btn-delete-list { position: absolute; top: 10px; right: 10px; background: rgba(239, 68, 68, 0.85); color: white; border: none; border-radius: 8px; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .btn-delete-list:hover { background: rgba(239, 68, 68, 1); transform: scale(1.1); }
        
        #editor-screen { display: flex; flex-direction: column; flex: 1; }
        .top-bar { background: rgba(9, 9, 11, 0.8); backdrop-filter: blur(12px); padding: 14px 24px; display: flex; gap: 16px; align-items: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border-color); }
        .list-name-input { flex: 1; background: transparent; border: none; color: var(--text-main); font-size: 1.15rem; font-weight: 600; outline: none; }
        .capture-wrapper { padding: 20px; background: var(--bg-base); } 
        
        #capture-area { background: transparent; display: flex; flex-direction: column; border-radius: 0; border: none; }
        .board-header-style { text-align: center; font-size: 1.75rem; font-weight: 800; padding: 25px 15px; background: #000; color: #fff; text-transform: uppercase; border-bottom: 1px solid #000; }
        #tier-board { display: flex; flex-direction: column; gap: 0; background: #000; border-top: 1px solid #000; } 
        
        /* Mobile Touch Optimization */
        .tier-row { display: flex; align-items: stretch; background: #1a1a1a; border-bottom: 1px solid #000; transition: border-top 0.2s; touch-action: none; }
        .tier-label-wrap { width: 120px; min-width: 120px; display: flex; align-items: center; justify-content: center; border-right: 1px solid #000; }
        .tier-label { font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: 400; line-height: 1.3; color: #000; text-align: center; padding: 8px; word-wrap: break-word; overflow-wrap: break-word; cursor: pointer; width: 100%; position: relative; }
        .tier-label::after { content: "‚öôÔ∏è"; position: absolute; bottom: 2px; right: 2px; font-size: 10px; opacity: 0.4; } 
        
        .tier-content { flex: 1; display: flex; flex-wrap: wrap; align-content: center; align-items: center; background: #1a1a1a; padding: 0px; gap: 0px; position: relative; min-height: 85px; }
        
        /* Mobile Touch Optimization */
        .img-wrap { display: block; position: relative; cursor: pointer; transition: transform 0.15s ease, box-shadow 0.1s; margin: 0; padding: 0; touch-action: none; }
        .img-wrap:active { transform: scale(0.95); }
        .img-item { height: 85px; width: auto; border-radius: 0; display: block; pointer-events: none; }
        .img-caption { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.7); color: white; font-size: 11px; text-align: center; padding: 2px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; pointer-events: none; }
        
        .dock-container { background: var(--bg-base); padding: 24px; flex: 1; border-top: 1px solid var(--border-color); }
        #dock { display: flex; flex-wrap: wrap; gap: 6px; padding: 10px; background: #0a0a0c; min-height: 100px; max-height: 35vh; overflow-y: auto; border: 1px solid var(--border-color); }

        .bottom-toolbar { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 960px; background: rgba(9, 9, 11, 0.85); backdrop-filter: blur(16px); padding: 16px 24px; display: flex; gap: 16px; border-top: 1px solid var(--border-color); z-index: 200; }
        .btn-bottom { flex: 1; padding: 14px; border: none; border-radius: var(--radius-md); font-size: 0.95rem; font-weight: 600; color: white; cursor: pointer; text-align: center; transition: transform 0.1s; }
        .btn-bottom:active { transform: scale(0.96); }
        .btn-save { background: var(--bg-surface); color: var(--text-main); border: 1px solid var(--border-color); } 
        .btn-add { background: var(--text-main); color: var(--bg-base); } 
        
        #resize-control { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 420px; background: rgba(24, 24, 27, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--radius-lg); z-index: 250; padding: 20px; display: flex; flex-direction: column; gap: 16px; box-shadow: var(--shadow-float); }
        .size-slider-wrap { display: flex; align-items: center; gap: 10px; }
        .btn-size-step { background: var(--bg-elevated); color: white; border: 1px solid var(--border-color); width: 34px; height: 34px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .btn-size-step:hover { background: var(--border-hover); }
        .resize-slider { flex: 1; height: 4px; background: var(--border-color); outline: none; -webkit-appearance: none; }
        
        .control-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-pill { flex: 1; padding: 12px 0; border-radius: var(--radius-md); border: none; font-weight: 600; font-size: 0.85rem; cursor: pointer; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 300; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal { background: var(--bg-surface); padding: 28px; border-radius: var(--radius-lg); width: 90%; max-width: 400px; border: 1px solid var(--border-color); }
        .modal input[type="text"], .modal textarea { width: 100%; padding: 14px; background: var(--bg-base); color: white; border: 1px solid var(--border-color); border-radius: var(--radius-md); outline: none; font-family: inherit; }
        .modal-btns { display: flex; flex-direction: column; gap: 10px; margin-top: 28px; }
        .modal-btns button { width: 100%; padding: 14px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; border: none; }
        
        .tier-controls-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; background: var(--bg-elevated); color: white; cursor: pointer; font-weight: bold; font-size: 0.9rem; }
        .tier-controls-btn:hover { background: var(--border-hover); }

        .color-preset-btn { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #000; transition: transform 0.1s; }
        .color-preset-btn:hover { transform: scale(1.1); }

        body.zen-mode .top-bar, body.zen-mode .board-footer-actions, body.zen-mode .dock-container, body.zen-mode .bottom-toolbar, body.zen-mode #resize-control { display: none !important; }
        #exit-zen-btn { display: none; position: fixed; top: 20px; right: 20px; z-index: 10000; padding: 12px 24px; background: rgba(255,255,255,0.1); color: white; border-radius: 9999px; border: 1px solid white; cursor: pointer; }
    </style>
</head>
<body>
    <div id="drop-overlay">K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ƒë·ªÉ th√™m</div>
    <button id="exit-zen-btn" onclick="toggleZenMode()">Tho√°t Zen Mode (ESC)</button>
    <div id="trash-zone">üóëÔ∏è</div>
    <div id="toast">üíæ ƒê√£ l∆∞u t·ª± ƒë·ªông</div>
    
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text" style="margin-top: 20px;">ƒêang x·ª≠ l√Ω...</p>
    </div>

    <div id="app-container">
        <div id="menu-screen">
            <h1 class="app-title">Tier<span>Maker</span></h1>
            <div class="menu-actions">
                <button class="btn-create" onclick="openCreateModal()">T·∫°o Template M·ªõi</button>
                <button class="btn-data" onclick="openBackupMenu()">D·ªØ li·ªáu & Sao l∆∞u</button>
            </div>
            <div id="list-container">ƒêang t·∫£i...</div>
        </div>
        
        <div id="editor-screen" class="hidden">
            <div class="top-bar">
                <button class="btn-back" style="background:transparent; color:white; border:none; cursor:pointer; font-weight:bold; font-size:1.1rem; padding:0 10px;" onclick="backToMenu()">‚Äπ Tho√°t</button>
                <input type="text" id="list-name" class="list-name-input" oninput="debounceSaveName()">
                <div class="top-actions" style="display:flex; gap:8px;">
                    <button class="btn-icon" onclick="undo()" title="Ho√†n t√°c (Ctrl+Z)" style="background:var(--bg-surface); color:white; border:1px solid #333; padding:5px 10px; border-radius:5px; cursor:pointer;">‚Ü©Ô∏è</button>
                    <button class="btn-icon" onclick="redo()" title="L√†m l·∫°i (Ctrl+Y)" style="background:var(--bg-surface); color:white; border:1px solid #333; padding:5px 10px; border-radius:5px; cursor:pointer;">‚Ü™Ô∏è</button>
                    <button class="btn-icon" onclick="toggleZenMode()" title="To√†n m√†n h√¨nh" style="background:var(--bg-surface); color:white; border:1px solid #333; padding:5px 10px; border-radius:5px; cursor:pointer;">üëÅÔ∏è</button>
                </div>
            </div>
            <div class="capture-wrapper"><div id="capture-area"><div id="tier-header" class="board-header-style" onclick="openHeaderModal()">B·∫£ng X·∫øp H·∫°ng</div><div id="tier-board"></div></div></div>
            <div class="board-footer-actions" style="padding: 0 20px 20px 20px; display:flex; gap:10px;">
                <button onclick="addNewTier()" style="background:#333; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Th√™m H√†ng</button>
                <button onclick="toggleHeader()" style="background:#333; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">·∫®n/Hi·ªán Ti√™u ƒë·ªÅ</button>
                <button onclick="resetBoard()" style="background:rgba(239,68,68,0.1); color:#ef4444; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Reset B·∫£ng</button>
            </div>
            <div id="dock-container-box" class="dock-container"><div id="dock" onclick="moveToDock()"></div></div>
            <div class="bottom-toolbar">
                <button class="btn-bottom btn-save" onclick="saveImage()">L∆∞u ·∫¢nh (4K)</button>
                <button class="btn-bottom btn-add" onclick="document.getElementById('imgInput').click()">Th√™m ·∫¢nh</button>
            </div>
            <input type="file" id="imgInput" multiple accept="image/*" onchange="handleFiles(event)" style="display:none">
        </div>

        <div id="resize-control" class="hidden">
            <div class="size-slider-wrap">
                <button class="btn-size-step" onclick="adjustSize(-5); commitChangeSilent();">-</button>
                <input type="range" id="size-slider" min="40" max="300" value="85" oninput="resizeSelectedImg(this.value)" onchange="commitChangeSilent()" class="resize-slider">
                <button class="btn-size-step" onclick="adjustSize(5); commitChangeSilent();">+</button>
                <span id="size-val" style="min-width:45px; text-align:right;">85px</span>
            </div>
            <div class="control-actions">
                <button class="btn-pill" onclick="moveToDock()" style="background:#333; color:white;">‚Üì C·∫•t Kho</button>
                <button class="btn-pill" onclick="openCaptionModal()" style="background:#333; color:white;">‚úçÔ∏è Ch·ªØ</button>
                <button class="btn-pill" onclick="applyToAll()" style="background:#fff; color:#000;">‚ú¶ C√πng c·ª°</button>
                <button class="btn-pill" onclick="deleteSelected()" style="background:#ef4444; color:white;">‚úï X√≥a (Del)</button>
            </div>
            <button onclick="deselectImg()" style="width:100%; margin-top:10px; background:transparent; border:1px solid #444; color:#fff; padding:10px; border-radius:8px; cursor:pointer;">Xong (Esc)</button>
        </div>
    </div>

    <div id="create-modal-overlay" class="modal-overlay"><div class="modal"><h2>T·∫°o b·∫£ng m·ªõi</h2><input type="text" id="new-template-name" placeholder="T√™n b·∫£ng..."><div class="modal-btns"><button class="btn-add" style="background:#fff; color:#000;" onclick="confirmCreateList()">T·∫°o</button><button onclick="closeModal('create-modal-overlay')" style="background:transparent; color:white;">H·ªßy</button></div></div></div>
    
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <h2>Ch·ªânh s·ª≠a H√†ng</h2>
            <input type="text" id="edit-name">
            
            <div style="margin-top:20px;">
                <label style="display:block; margin-bottom:8px; font-weight:bold;">M√†u n·ªÅn:</label>
                <div style="display:flex; align-items:center; gap:10px;">
                    <input type="color" id="edit-color-picker" style="cursor:pointer; width: 40px; height: 35px; border:none; background:transparent;">
                    
                    <div style="display:flex; flex-wrap:wrap; gap:6px; max-width: 280px;">
                        <div class="color-preset-btn" style="background:#FF7F7F;" onclick="setTierColor('#FF7F7F')"></div>
                        <div class="color-preset-btn" style="background:#FFBF7F;" onclick="setTierColor('#FFBF7F')"></div>
                        <div class="color-preset-btn" style="background:#FFDF7F;" onclick="setTierColor('#FFDF7F')"></div>
                        <div class="color-preset-btn" style="background:#FFFF7F;" onclick="setTierColor('#FFFF7F')"></div>
                        <div class="color-preset-btn" style="background:#BFFF7F;" onclick="setTierColor('#BFFF7F')"></div>
                        <div class="color-preset-btn" style="background:#7FFF7F;" onclick="setTierColor('#7FFF7F')"></div>
                        <div class="color-preset-btn" style="background:#7FFFFF;" onclick="setTierColor('#7FFFFF')"></div>
                        <div class="color-preset-btn" style="background:#7FBFFF;" onclick="setTierColor('#7FBFFF')"></div>
                        <div class="color-preset-btn" style="background:#7F7FFF;" onclick="setTierColor('#7F7FFF')"></div>
                        <div class="color-preset-btn" style="background:#FF7FFF;" onclick="setTierColor('#FF7FFF')"></div>
                        <div class="color-preset-btn" style="background:#BF7FFF;" onclick="setTierColor('#BF7FFF')"></div>
                        <div class="color-preset-btn" style="background:#333333;" onclick="setTierColor('#333333')"></div>
                        <div class="color-preset-btn" style="background:#888888;" onclick="setTierColor('#888888')"></div>
                        <div class="color-preset-btn" style="background:#CCCCCC;" onclick="setTierColor('#CCCCCC')"></div>
                        <div class="color-preset-btn" style="background:#FFFFFF;" onclick="setTierColor('#FFFFFF')"></div>
                    </div>
                </div>
            </div>

            <div style="margin-top:25px; display:flex; gap:10px;">
                <button class="tier-controls-btn" onclick="moveTierUp()">üîº ƒê·∫©y l√™n</button>
                <button class="tier-controls-btn" onclick="moveTierDown()">üîΩ ƒê·∫©y xu·ªëng</button>
            </div>
            
            <div class="modal-btns">
                <button style="background:#fff; color:#000;" onclick="saveTierEdit()">L∆∞u thay ƒë·ªïi</button>
                <button style="background:var(--danger); color:#fff;" onclick="deleteTier()">X√≥a H√†ng</button>
                <button style="background:transparent; color:white;" onclick="closeModal('modal-overlay')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <div id="caption-modal-overlay" class="modal-overlay"><div class="modal"><h2>Ch√∫ th√≠ch ·∫£nh</h2><input type="text" id="caption-input" placeholder="T√™n nh√¢n v·∫≠t..."><div class="modal-btns"><button style="background:#fff; color:#000;" onclick="saveCaption()">OK</button><button style="background:transparent; color:white;" onclick="closeModal('caption-modal-overlay')">H·ªßy</button></div></div></div>

    <div id="backup-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h2>D·ªØ li·ªáu & Sao l∆∞u</h2>
            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom: 20px;">Sao l∆∞u b·∫±ng file ho·∫∑c Copy/Paste tr·ª±c ti·∫øp ƒë·ªÉ chuy·ªÉn sang m√°y kh√°c.</p>
            <div class="modal-btns">
                <button style="background:var(--primary); color:#fff;" onclick="exportData()">‚¨áÔ∏è Xu·∫•t d·ªØ li·ªáu (T·∫£i file)</button>
                <button style="background:var(--accent); color:#fff;" onclick="document.getElementById('importInput').click()">‚¨ÜÔ∏è Nh·∫≠p d·ªØ li·ªáu (Kh√¥i ph·ª•c t·ª´ file)</button>
                
                <button style="background:#f59e0b; color:#fff; margin-top:10px;" onclick="copyDataToClipboard()">üìã Copy Code (ƒê·ªÉ d√°n m√°y kh√°c)</button>
                <button style="background:#8b5cf6; color:#fff; margin-top:5px;" onclick="pasteDataFromClipboard()">üìù D√°n Code (L·∫•y t·ª´ m√°y kh√°c)</button>

                <button style="background:var(--danger); color:#fff; margin-top:15px;" onclick="wipeAllData()">üóëÔ∏è X√≥a s·∫°ch m·ªçi th·ª© (Reset)</button>
                
                <button style="background:transparent; color:white; margin-top:5px;" onclick="closeModal('backup-modal-overlay')">ƒê√≥ng</button>
            </div>
            <input type="file" id="importInput" accept=".json" onchange="importData(event)" style="display:none">
        </div>
    </div>

    <div id="manual-paste-modal" class="modal-overlay">
        <div class="modal">
            <h2>D√°n m√£ d·ªØ li·ªáu</h2>
            <p style="color:var(--text-muted); font-size:0.85rem;">Tr√¨nh duy·ªát c·ªßa b·∫°n ch·∫∑n d√°n t·ª± ƒë·ªông. Vui l√≤ng b·∫•m v√†o √¥ b√™n d∆∞·ªõi v√† nh·∫•n <b>Ctrl+V</b> (ho·∫∑c Nh·∫•n gi·ªØ > D√°n).</p>
            <textarea id="manual-paste-textarea" rows="4" placeholder="D√°n m√£ v√†o ƒë√¢y..."></textarea>
            <div class="modal-btns">
                <button style="background:#8b5cf6; color:#fff;" onclick="processManualPaste()">Kh√¥i ph·ª•c d·ªØ li·ªáu</button>
                <button style="background:transparent; color:white;" onclick="closeModal('manual-paste-modal')">H·ªßy</button>
            </div>
        </div>
    </div>

    <script>
        const DB_NAME = 'TierMaker_V26_Pro'; 
        let db, currentListData, selectedImgObj = null, editingTierIndex = -1, draggedItem = null, draggedRowIdx = null;
        let stateHistory = [], historyIndex = -1;
        let saveTimeout, toastTimeout;

        window.onload = () => { 
            const req = indexedDB.open(DB_NAME, 1); 
            req.onupgradeneeded = e => e.target.result.createObjectStore('lists', {keyPath:'id'}); 
            req.onsuccess = e => { db=e.target.result; loadMenu(); initGlobalFileDrop(); initKeyboardShortcuts(); }; 
        };
        
        // 1. Toast Notification
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show');
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // 2. Global File Drop Fix
        function initGlobalFileDrop() { 
            const overlay = document.getElementById('drop-overlay'); 
            
            window.addEventListener('dragenter', e => { 
                if (draggedItem) return; 
                if (e.dataTransfer.types.includes("Files")) { 
                    e.preventDefault(); 
                    overlay.style.display = 'flex'; 
                } 
            }); 
            
            overlay.addEventListener('dragleave', e => { 
                e.preventDefault(); 
                overlay.style.display = 'none'; 
            }); 
            
            window.addEventListener('dragover', e => { e.preventDefault(); });
            
            window.addEventListener('drop', e => { 
                overlay.style.display = 'none'; 
                if (draggedItem) return; 
                e.preventDefault(); 
                if (e.dataTransfer.files.length > 0) {
                    if(!currentListData) { alert("Vui l√≤ng m·ªü m·ªôt b·∫£ng x·∫øp h·∫°ng tr∆∞·ªõc khi th√™m ·∫£nh!"); return; }
                    handleFiles({target: {files: e.dataTransfer.files}}); 
                }
            }); 
        }

        // 3. Ph√≠m t·∫Øt (Keyboard Shortcuts)
        function initKeyboardShortcuts() {
            window.addEventListener('keydown', e => {
                // Ki·ªÉm tra n·∫øu ƒëang focus v√†o √¥ input/textarea th√¨ kh√¥ng k√≠ch ho·∫°t ph√≠m t·∫Øt h·ªá th·ªëng (tr·ª´ modal)
                if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                if (e.ctrlKey || e.metaKey) {
                    if (e.key.toLowerCase() === 'z') { e.preventDefault(); undo(); }
                    if (e.key.toLowerCase() === 'y') { e.preventDefault(); redo(); }
                }
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    if (selectedImgObj) { e.preventDefault(); deleteSelected(); }
                }
                if (e.key === 'Escape') {
                    if (document.body.classList.contains('zen-mode')) toggleZenMode();
                    if (selectedImgObj) deselectImg();
                    document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none');
                }
            });
        }

        function loadMenu() { 
            db.transaction(['lists']).objectStore('lists').getAll().onsuccess = e => { 
                const list = e.target.result; 
                const container = document.getElementById('list-container'); 
                
                if (list.length === 0) {
                    container.innerHTML = `<div style="text-align:center; padding: 60px 20px; color: var(--text-muted); grid-column: 1/-1; font-size: 1.1rem;">üìÅ<br><br>B·∫°n ch∆∞a c√≥ b·∫£ng x·∫øp h·∫°ng n√†o.<br>H√£y b·∫•m <b>T·∫°o Template M·ªõi</b> ·ªü tr√™n nh√©!</div>`;
                    return;
                }

                container.innerHTML = list.map(l => `
                    <div class="list-item" onclick="openList('${l.id}')">
                        <button class="btn-delete-list" onclick="deleteSingleList(event, '${l.id}')">üóëÔ∏è</button>
                        <img src="${l.thumbnail || ''}" style="width:100%; height:180px; object-fit:cover; object-position:top; border-radius:5px 5px 0 0; background:#000;">
                        <div class="list-info-wrap">
                            <h3 style="margin:0; font-size:1rem; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${l.name}</h3>
                        </div>
                    </div>
                `).join(''); 
            }; 
        }

        function deleteSingleList(e, id) {
            e.stopPropagation(); 
            if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b·∫£ng n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.")) {
                const tx = db.transaction(['lists'], 'readwrite');
                tx.objectStore('lists').delete(id);
                tx.oncomplete = () => loadMenu(); 
            }
        }
        
        function commitChange() { pushHistory(); renderBoard(); saveList(currentListData); }
        function commitChangeSilent() { pushHistory(); saveList(currentListData); }
        function pushHistory() { const s = JSON.stringify(currentListData); if(stateHistory[historyIndex] !== s) { stateHistory = stateHistory.slice(0, historyIndex+1); stateHistory.push(s); historyIndex++; if(stateHistory.length > 10) { stateHistory.shift(); historyIndex--; } } }
        function undo() { if(historyIndex > 0) { historyIndex--; currentListData = JSON.parse(stateHistory[historyIndex]); renderBoard(); saveListSilent(currentListData); showToast("‚Ü©Ô∏è ƒê√£ ho√†n t√°c"); } }
        function redo() { if(historyIndex < stateHistory.length-1) { historyIndex++; currentListData = JSON.parse(stateHistory[historyIndex]); renderBoard(); saveListSilent(currentListData); showToast("‚Ü™Ô∏è ƒê√£ l√†m l·∫°i"); } }

        function openList(id) { db.transaction(['lists']).objectStore('lists').get(id).onsuccess = e => { currentListData = e.target.result; stateHistory = [JSON.stringify(currentListData)]; historyIndex = 0; document.getElementById('menu-screen').classList.add('hidden'); document.getElementById('editor-screen').classList.remove('hidden'); document.getElementById('list-name').value = currentListData.name; renderBoard(); }; }
        
        function renderBoard() {
            const board = document.getElementById('tier-board'); board.innerHTML = '';
            const hEl = document.getElementById('tier-header'); hEl.innerText = currentListData.name;
            currentListData.tiers.forEach((t, i) => {
                const row = document.createElement('div'); row.className = 'tier-row'; row.style.backgroundColor = t.color;
                row.draggable = true; 
                row.ondragstart = e => { if(e.target.closest('.img-wrap')) return; draggedRowIdx = i; };
                
                row.ondragover = e => { 
                    if(draggedRowIdx !== null) {
                        e.preventDefault();
                        e.currentTarget.style.borderTop = "3px solid #10b981";
                    }
                };
                row.ondragleave = e => {
                    if(draggedRowIdx !== null) {
                        e.currentTarget.style.borderTop = "";
                    }
                };
                row.ondrop = e => { 
                    e.currentTarget.style.borderTop = "";
                    if(draggedRowIdx !== null) { 
                        const tmp = currentListData.tiers.splice(draggedRowIdx, 1)[0]; 
                        currentListData.tiers.splice(i, 0, tmp); 
                        draggedRowIdx = null; 
                        commitChange(); 
                    } 
                };
                
                const labelWrap = document.createElement('div'); labelWrap.className = 'tier-label-wrap';
                const label = document.createElement('div'); label.className = 'tier-label'; label.innerText = t.name; label.onclick = () => openEditModal(i);
                labelWrap.appendChild(label);

                const content = document.createElement('div'); content.className = 'tier-content';
                content.ondragover = e => { if(draggedItem) e.preventDefault(); };
                
                content.ondrop = e => { 
                    if(draggedItem && e.target === content) { 
                        let newArray = currentListData.tiers[i].items;
                        let oldArray = (draggedItem.type === 'tier') ? currentListData.tiers[draggedItem.r].items : currentListData.dock;
                        oldArray.splice(draggedItem.i, 1);
                        newArray.push(draggedItem.data);
                        draggedItem = null;
                        commitChange(); 
                    } 
                };
                
                t.items.forEach((img, idx) => content.appendChild(createImg(img, 'tier', i, idx)));

                row.appendChild(labelWrap); row.appendChild(content); board.appendChild(row);
            });
            const dock = document.getElementById('dock'); dock.innerHTML = '';
            currentListData.dock.forEach((img, idx) => dock.appendChild(createImg(img, 'dock', null, idx)));
        }

        function createImg(data, type, r, i) {
            const wrap = document.createElement('div'); wrap.className = 'img-wrap'; 
            wrap.style.height = (type==='tier' ? data.h : 85) + 'px';
            const img = document.createElement('img'); img.src = data.src; img.className = 'img-item'; 
            img.style.height = (type==='tier' ? data.h : 85) + 'px';
            wrap.appendChild(img);
            if(data.caption) { const c = document.createElement('div'); c.className = 'img-caption'; c.innerText = data.caption; wrap.appendChild(c); }
            
            wrap.onclick = e => { e.stopPropagation(); clickImg(wrap, data, type, r, i); };
            wrap.draggable = true;
            
            wrap.ondragstart = e => { 
                e.stopPropagation(); 
                draggedItem = {data, type, r, i}; 
                const tz = document.getElementById('trash-zone');
                tz.style.display='flex'; 
                tz.classList.remove('hover');
            };
            wrap.ondragend = () => { draggedItem = null; document.getElementById('trash-zone').style.display='none'; };

            wrap.ondragover = e => {
                if (!draggedItem || draggedItem.data === data) return;
                e.preventDefault();
                e.stopPropagation();
                const rect = wrap.getBoundingClientRect();
                const mid = rect.left + rect.width / 2;
                if (e.clientX < mid) {
                    wrap.style.boxShadow = "-3px 0 0 #10b981"; 
                } else {
                    wrap.style.boxShadow = "3px 0 0 #10b981";  
                }
                wrap.style.zIndex = "10";
            };

            wrap.ondragleave = e => {
                wrap.style.boxShadow = "none";
                wrap.style.zIndex = "1";
            };

            wrap.ondrop = e => {
                e.preventDefault();
                e.stopPropagation();
                wrap.style.boxShadow = "none";
                wrap.style.zIndex = "1";

                if(draggedItem && draggedItem.data !== data) {
                    const rect = wrap.getBoundingClientRect();
                    const mid = rect.left + rect.width / 2;
                    let targetIndex = i;
                    if(e.clientX >= mid) targetIndex++;

                    let oldArray = (draggedItem.type === 'tier') ? currentListData.tiers[draggedItem.r].items : currentListData.dock;
                    let newArray = (type === 'tier') ? currentListData.tiers[r].items : currentListData.dock;

                    oldArray.splice(draggedItem.i, 1);
                    if (oldArray === newArray && draggedItem.i < targetIndex) targetIndex--;
                    
                    newArray.splice(targetIndex, 0, draggedItem.data);
                    draggedItem = null;
                    commitChange();
                }
            };
            return wrap;
        }

        const tz = document.getElementById('trash-zone');
        tz.ondragover = e => { e.preventDefault(); tz.classList.add('hover'); };
        tz.ondragleave = () => tz.classList.remove('hover');
        tz.ondrop = () => { 
            if(draggedItem) { 
                let oldArray = (draggedItem.type === 'tier') ? currentListData.tiers[draggedItem.r].items : currentListData.dock; 
                oldArray.splice(draggedItem.i, 1); 
                commitChange(); 
                tz.classList.remove('hover');
            } 
        };

        function clickImg(dom, data, type, r, i) { 
            if(!selectedImgObj) { 
                selectedImgObj = {dom, data, type, r, i}; 
                dom.classList.add('selected'); 
                document.getElementById('resize-control').classList.remove('hidden'); 
                document.getElementById('size-slider').value = data.h;
                document.getElementById('size-val').innerText = data.h + 'px';
            } else if(selectedImgObj.dom === dom) deselectImg(); 
        }
        
        function deselectImg() { if(selectedImgObj) selectedImgObj.dom.classList.remove('selected'); selectedImgObj = null; document.getElementById('resize-control').classList.add('hidden'); }
        
        function resizeSelectedImg(h) { 
            if(selectedImgObj) { 
                h = parseInt(h);
                selectedImgObj.data.h = h; 
                selectedImgObj.dom.style.height = h+'px'; 
                selectedImgObj.dom.querySelector('.img-item').style.height = h+'px';
                document.getElementById('size-val').innerText = h+'px'; 
                document.getElementById('size-slider').value = h;
            } 
        }
        
        function adjustSize(d) { if(selectedImgObj) { let newH = parseInt(document.getElementById('size-slider').value) + d; newH = Math.max(40, Math.min(300, newH)); resizeSelectedImg(newH); } }
        
        function applyToAll() { const h = selectedImgObj.data.h; currentListData.tiers.forEach(t => t.items.forEach(i => i.h = h)); currentListData.dock.forEach(i => i.h = h); commitChange(); }
        
        function showLoading(text) {
            document.getElementById('loading-text').innerText = text;
            document.getElementById('loading-overlay').style.display='flex';
        }
        function hideLoading() {
            document.getElementById('loading-overlay').style.display='none';
        }

        function saveImage() { 
            deselectImg(); 
            showLoading('ƒêang xu·∫•t ·∫£nh 4K...');
            setTimeout(() => { 
                html2canvas(document.getElementById('capture-area'), {
                    scale: 4, 
                    backgroundColor: null, 
                    useCORS: true 
                }).then(c => { 
                    const a = document.createElement('a'); 
                    a.download = 'TierList.png'; 
                    a.href = c.toDataURL('image/png', 1.0); 
                    a.click(); 
                    hideLoading();
                }); 
            }, 100); 
        }
        
        function handleFiles(e) { Array.from(e.target.files).forEach(f => { const r = new FileReader(); r.onload = ev => { const i = new Image(); i.src = ev.target.result; i.onload = () => { const c = document.createElement('canvas'), x = c.getContext('2d'), M = 2500; let w = i.width, h = i.height; if(w>M){h*=(M/w);w=M;} c.width = w; c.height = h; x.drawImage(i, 0, 0, w, h); currentListData.dock.push({src: c.toDataURL('image/png', 1.0), h:85}); commitChange(); }}; r.readAsDataURL(f); }); }
        
        function saveList(d) { 
            d.updatedAt = new Date().toISOString(); 
            db.transaction(['lists'], 'readwrite').objectStore('lists').put(d); 
            showToast('üíæ ƒê√£ l∆∞u t·ª± ƒë·ªông');
        }
        // L∆∞u im l·∫∑ng (cho Undo/Redo tr√°nh l·∫∑p Toast)
        function saveListSilent(d) {
            d.updatedAt = new Date().toISOString(); 
            db.transaction(['lists'], 'readwrite').objectStore('lists').put(d); 
        }

        function toggleZenMode() { document.body.classList.toggle('zen-mode'); if(document.body.classList.contains('zen-mode')) document.getElementById('exit-zen-btn').style.display='block'; else document.getElementById('exit-zen-btn').style.display='none'; }
        function openCreateModal() { document.getElementById('create-modal-overlay').style.display='flex'; document.getElementById('new-template-name').focus(); }
        
        // 4. Ki·ªÉm tra tr√πng t√™n b·∫£ng
        function confirmCreateList() { 
            const name = document.getElementById('new-template-name').value.trim() || 'B·∫£ng m·ªõi'; 
            db.transaction(['lists']).objectStore('lists').getAll().onsuccess = e => {
                const list = e.target.result;
                if(list.some(l => l.name.toLowerCase() === name.toLowerCase())) {
                    alert('‚ö†Ô∏è T√™n b·∫£ng ƒë√£ t·ªìn t·∫°i! Vui l√≤ng ch·ªçn t√™n kh√°c.');
                    return;
                }
                const newList = { id: 'list_'+Date.now(), name: name, tiers: [{name:'S', color:'#FF7F7F', items:[]}], dock: [] }; 
                saveListSilent(newList); 
                loadMenu(); 
                closeModal('create-modal-overlay'); 
                document.getElementById('new-template-name').value = '';
            };
        }
        
        function openEditModal(i) { 
            editingTierIndex = i; 
            const t = currentListData.tiers[i]; 
            document.getElementById('edit-name').value = t.name; 
            document.getElementById('edit-color-picker').value = t.color; 
            document.getElementById('modal-overlay').style.display='flex'; 
            document.getElementById('edit-name').focus();
        }
        
        function setTierColor(color) { document.getElementById('edit-color-picker').value = color; }

        function saveTierEdit() { 
            const t = currentListData.tiers[editingTierIndex]; 
            t.name = document.getElementById('edit-name').value; 
            t.color = document.getElementById('edit-color-picker').value; 
            closeModal('modal-overlay'); 
            commitChange(); 
        }

        function moveTierUp() {
            if(editingTierIndex > 0) {
                const tmp = currentListData.tiers[editingTierIndex];
                currentListData.tiers[editingTierIndex] = currentListData.tiers[editingTierIndex - 1];
                currentListData.tiers[editingTierIndex - 1] = tmp;
                editingTierIndex--;
                commitChange();
            }
        }

        function moveTierDown() {
            if(editingTierIndex < currentListData.tiers.length - 1) {
                const tmp = currentListData.tiers[editingTierIndex];
                currentListData.tiers[editingTierIndex] = currentListData.tiers[editingTierIndex + 1];
                currentListData.tiers[editingTierIndex + 1] = tmp;
                editingTierIndex++;
                commitChange();
            }
        }

        // ƒê√£ s·ª≠a ƒë·ªÉ h·ªó tr·ª£ Undo sau khi x√≥a H√†ng
        function deleteTier() {
            if(confirm("X√≥a h√†ng n√†y? C√°c ·∫£nh trong h√†ng (n·∫øu c√≥) c≈©ng s·∫Ω b·ªã x√≥a.")) {
                currentListData.tiers.splice(editingTierIndex, 1);
                closeModal('modal-overlay');
                commitChange(); 
            }
        }

        function addNewTier() { currentListData.tiers.push({name:'NEW', color:'#1a1a1a', items:[]}); commitChange(); }
        function toggleHeader() { currentListData.headerVisible = !currentListData.headerVisible; commitChange(); }
        function resetBoard() { currentListData.tiers.forEach(t => { currentListData.dock.push(...t.items); t.items = []; }); commitChange(); }
        
        function openCaptionModal() { if(selectedImgObj) { document.getElementById('caption-input').value = selectedImgObj.data.caption || ''; document.getElementById('caption-modal-overlay').style.display='flex'; document.getElementById('caption-input').focus(); } }
        function saveCaption() { selectedImgObj.data.caption = document.getElementById('caption-input').value; closeModal('caption-modal-overlay'); commitChange(); }
        function deleteSelected() { let oldArray = (selectedImgObj.type === 'tier') ? currentListData.tiers[selectedImgObj.r].items : currentListData.dock; oldArray.splice(selectedImgObj.i, 1); commitChange(); deselectImg(); }
        function moveToDock() { let oldArray = (selectedImgObj.type === 'tier') ? currentListData.tiers[selectedImgObj.r].items : currentListData.dock; oldArray.splice(selectedImgObj.i, 1); currentListData.dock.push(selectedImgObj.data); commitChange(); deselectImg(); }
        function closeModal(id) { document.getElementById(id).style.display='none'; }
        
        // Auto-save khi g√µ t√™n b·∫£ng (Debounce 500ms)
        function debounceSaveName() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                currentListData.name = document.getElementById('list-name').value; 
                commitChangeSilent(); 
                document.getElementById('tier-header').innerText = currentListData.name;
            }, 500);
        }
        
        async function backToMenu() { 
            deselectImg(); 
            showLoading('ƒêang l∆∞u b·∫£ng...');
            
            try {
                const canvas = await html2canvas(document.getElementById('capture-area'), {
                    scale: 1, 
                    backgroundColor: '#000', 
                    useCORS: true 
                });
                currentListData.thumbnail = canvas.toDataURL('image/jpeg', 0.6); 
                saveListSilent(currentListData);
            } catch (err) {
                console.error("Kh√¥ng th·ªÉ ch·ª•p thumbnail:", err);
            }

            hideLoading();
            document.getElementById('editor-screen').classList.add('hidden'); 
            document.getElementById('menu-screen').classList.remove('hidden'); 
            loadMenu(); 
        }

        function openBackupMenu() { document.getElementById('backup-modal-overlay').style.display='flex'; }
        
        function exportData() {
            db.transaction(['lists']).objectStore('lists').getAll().onsuccess = e => {
                const data = JSON.stringify(e.target.result);
                const blob = new Blob([data], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `TierMaker_Backup_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };
        }

        function importData(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                try {
                    const data = JSON.parse(ev.target.result);
                    const tx = db.transaction(['lists'], 'readwrite');
                    const store = tx.objectStore('lists');
                    data.forEach(item => store.put(item));
                    tx.oncomplete = () => {
                        alert('‚úÖ ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ File th√†nh c√¥ng!');
                        loadMenu();
                        closeModal('backup-modal-overlay');
                    };
                } catch(err) {
                    alert('‚ùå File kh√¥ng h·ª£p l·ªá ho·∫∑c b·ªã l·ªói!');
                }
            };
            reader.readAsText(file);
            e.target.value = ''; 
        }

        async function copyDataToClipboard() {
            db.transaction(['lists']).objectStore('lists').getAll().onsuccess = async e => {
                try {
                    const data = JSON.stringify(e.target.result);
                    await navigator.clipboard.writeText(data);
                    alert('‚úÖ ƒê√£ Copy to√†n b·ªô d·ªØ li·ªáu th√†nh c√¥ng!\n\nB√¢y gi·ªù b·∫°n c√≥ th·ªÉ m·ªü trang web n√†y ·ªü m√°y kh√°c v√† b·∫•m n√∫t "D√°n Code".');
                } catch (err) {
                    alert('‚ùå L·ªói: Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ copy t·ª± ƒë·ªông ho·∫∑c d·ªØ li·ªáu qu√° n·∫∑ng. Vui l√≤ng d√πng t√≠nh nƒÉng T·∫£i file.');
                    console.error(err);
                }
            };
        }

        // 5. C·∫£i thi·ªán b·∫£o m·∫≠t v√† Fallback cho Clipboard
        async function pasteDataFromClipboard() {
            try {
                const clipboardText = await navigator.clipboard.readText();
                if (!clipboardText) {
                    alert('‚ö†Ô∏è B·ªô nh·ªõ t·∫°m (Clipboard) ƒëang tr·ªëng! B·∫°n ph·∫£i copy d·ªØ li·ªáu t·ª´ m√°y kia tr∆∞·ªõc.');
                    return;
                }
                processPastedString(clipboardText);
            } catch (err) {
                // FALLBACK: Tr√¨nh duy·ªát ch·∫∑n quy·ªÅn (VD: Firefox, iOS kh√¥ng HTTPS)
                document.getElementById('manual-paste-textarea').value = '';
                document.getElementById('manual-paste-modal').style.display = 'flex';
                document.getElementById('manual-paste-textarea').focus();
            }
        }

        function processManualPaste() {
            const text = document.getElementById('manual-paste-textarea').value;
            if(!text) { alert('‚ö†Ô∏è Vui l√≤ng d√°n m√£ v√†o √¥ tr·ªëng!'); return; }
            closeModal('manual-paste-modal');
            processPastedString(text);
        }

        function processPastedString(clipboardText) {
            try {
                const data = JSON.parse(clipboardText);
                if (!Array.isArray(data)) {
                    alert('‚ùå L·ªói: ƒêo·∫°n m√£ b·∫°n d√°n kh√¥ng ph·∫£i l√† d·ªØ li·ªáu c·ªßa Tier List h·ª£p l·ªá!');
                    return;
                }

                const tx = db.transaction(['lists'], 'readwrite');
                const store = tx.objectStore('lists');
                data.forEach(item => store.put(item));
                
                tx.oncomplete = () => {
                    alert('‚úÖ ƒê√£ d√°n v√† kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!');
                    loadMenu();
                    closeModal('backup-modal-overlay');
                };
            } catch(e) {
                alert('‚ùå L·ªói ƒë·ªãnh d·∫°ng: M√£ d√°n v√†o kh√¥ng h·ª£p l·ªá ho·∫∑c b·ªã thi·∫øu ch·ªØ!');
            }
        }

        function wipeAllData() {
            if(confirm("‚ö†Ô∏è C·∫¢NH B√ÅO M·ª®C ƒê·ªò CAO:\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a TO√ÄN B·ªò b·∫£ng x·∫øp h·∫°ng v√† h√¨nh ·∫£nh kh·ªèi m√°y kh√¥ng?\nH√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ ho√†n t√°c!")) {
                const req = db.transaction(['lists'], 'readwrite').objectStore('lists').clear();
                req.onsuccess = () => {
                    alert('ƒê√£ d·ªçn d·∫πp s·∫°ch s·∫Ω to√†n b·ªô d·ªØ li·ªáu!');
                    location.reload(); 
                };
            }
        }
    </script>
</body>
</html>
